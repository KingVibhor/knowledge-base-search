<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Knowledge Base RAG Engine</title>
    <style>
        body {
        font-family: Arial, sans-serif;
        max-width: 900px;
        margin: auto;
        padding: 20px;
        }

        .container {
        border: 1px solid #ddd;
        padding: 20px;
        border-radius: 10px;
        background: #fff;
        }

        textarea, input, button {
        width: 100%;
        padding: 12px;
        margin-top: 8px;
        border-radius: 6px;
        border: 1px solid #aaa;
        }

        button {
        background: #1e88e5;
        color: white;
        font-size: 16px;
        cursor: pointer;
        border: none;
        }

        button:hover {
        background: #1565c0;
        }

        .answer-box {
        white-space: pre-wrap;      
        overflow-wrap: break-word;  
        border: 1px solid #ccc;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        margin-top: 10px;
        }

        .source-box {
        border: 1px solid #ccc;
        padding: 12px;
        background: #f0f0f0;
        border-radius: 6px;
        margin-top: 10px;
        }
        </style>
</head>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<body>

<div class="container">

    <h1>Knowledge Base RAG Engine</h1>

    <!-- Upload Section -->
    <div>
        <p class="section-title">Upload Document</p>
        <input type="file" id="fileInput" class="input-box">
        <button onclick="uploadFile()">Upload</button>
        <pre id="uploadResult"></pre>
    </div>

    <!-- Query Section -->
    <div>
        <p class="section-title">Ask a Question</p>
        <textarea id="question" rows="3" class="input-box"></textarea>
        <button onclick="ask()">Ask</button>

        <p class="section-title">Answer</p>
        <div id="answerBox" class="answer-box"></div>

        <p class="section-title">Sources</p>
        <div id="sourcesBox" class="sources"></div>
    </div>

</div>


<script>
    async function uploadFile() {
        let file = document.getElementById("fileInput").files[0];
        if (!file) {
            alert("Select a file first.");
            return;
        }

        let formData = new FormData();
        formData.append("file", file);

        let res = await fetch("http://127.0.0.1:8000/ingest", {
            method: "POST",
            body: formData
        });

        document.getElementById("uploadResult").textContent =
            JSON.stringify(await res.json(), null, 2);
    }


    async function ask() {
    let question = document.getElementById("question").value;

    let formData = new FormData();
    formData.append("query", question);

    let res = await fetch("http://127.0.0.1:8000/query", {
        method: "POST",
        body: formData
    });

    let data = await res.json();


    document.getElementById("answerBox").innerHTML = marked.parse(data.answer);

    document.getElementById("sourcesBox").innerHTML =
        data.sources.map(s =>
            `<b>${s.source} (chunk ${s.chunk_index})</b><br>${s.text}<br><br>`
        ).join("");
    }

</script>

</body>
</html>
